/*
 * Produces jar files that can be deployed directly to JBoss.
 */
snowdropFiles = file("$buildDir/snowdrop")

jar {
    extension = 'spring'
    metaInf {
        from snowdropFiles
    }
}


task createSnowdropDir(type: Directory) {
    dir = snowdropFiles
}


/**
 * Generates the snowdrop-specific deployment descriptor, 'jboss-spring.xml'.
 */
task createDeploymentDescriptor(dependsOn: createSnowdropDir) << {
    def descriptor = 

'''<?xml version="1.0" encoding="UTF-8"?>
<beans default-autowire="no" xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="
  http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <import resource="applicationContext.xml" />
</beans>'''

    new File(snowdropFiles, "jboss-spring.xml").withWriter('UTF-8') {
        it.write(descriptor)
    }
}

jar.dependsOn createDeploymentDescriptor

